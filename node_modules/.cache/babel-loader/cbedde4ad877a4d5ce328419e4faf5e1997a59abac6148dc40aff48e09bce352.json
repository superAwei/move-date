{"ast":null,"code":"import { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, normalizeClass as _normalizeClass, vModelText as _vModelText, withDirectives as _withDirectives, withModifiers as _withModifiers } from \"vue\";\nconst _hoisted_1 = {\n  class: \"chat\"\n};\nconst _hoisted_2 = {\n  class: \"messages\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"h2\", null, \"Chat with \" + _toDisplayString($setup.matchEmail), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_2, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.messages, message => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: message.id,\n      class: _normalizeClass(['message', message.sender === $setup.currentUser.uid ? 'sent' : 'received'])\n    }, _toDisplayString(message.text), 3 /* TEXT, CLASS */);\n  }), 128 /* KEYED_FRAGMENT */))]), _createElementVNode(\"form\", {\n    onSubmit: _cache[1] || (_cache[1] = _withModifiers((...args) => $setup.sendMessage && $setup.sendMessage(...args), [\"prevent\"]))\n  }, [_withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.newMessage = $event),\n    placeholder: \"Type a message...\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.newMessage]]), _cache[2] || (_cache[2] = _createElementVNode(\"button\", {\n    type: \"submit\"\n  }, \"Send\", -1 /* HOISTED */))], 32 /* NEED_HYDRATION */)]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createElementVNode","_toDisplayString","$setup","matchEmail","_hoisted_2","_Fragment","_renderList","messages","message","key","id","_normalizeClass","sender","currentUser","uid","text","onSubmit","_cache","_withModifiers","args","sendMessage","$event","newMessage","placeholder","type"],"sources":["/Users/awei/Desktop/movie dating/src/views/Chat.vue"],"sourcesContent":["<template>\n  <div class=\"chat\">\n    <h2>Chat with {{ matchEmail }}</h2>\n    <div class=\"messages\">\n      <div v-for=\"message in messages\" :key=\"message.id\" :class=\"['message', message.sender === currentUser.uid ? 'sent' : 'received']\">\n        {{ message.text }}\n      </div>\n    </div>\n    <form @submit.prevent=\"sendMessage\">\n      <input v-model=\"newMessage\" placeholder=\"Type a message...\">\n      <button type=\"submit\">Send</button>\n    </form>\n  </div>\n</template>\n\n<script>\nimport { ref, onMounted, onUnmounted } from 'vue'\nimport { useRoute } from 'vue-router'\nimport { auth, rtdb } from '@/firebase'\nimport { ref as dbRef, push, onChildAdded, off } from 'firebase/database'\nimport { doc, getDoc } from 'firebase/firestore'\nimport { db } from '@/firebase'\n\nexport default {\n  name: 'ChatView',\n  setup() {\n    const route = useRoute()\n    const matchId = route.params.id\n    const currentUser = auth.currentUser\n    const messages = ref([])\n    const newMessage = ref('')\n    const matchEmail = ref('')\n\n    const chatRef = dbRef(rtdb, `chats/${currentUser.uid}_${matchId}`)\n\n    onMounted(async () => {\n      onChildAdded(chatRef, (snapshot) => {\n        messages.value.push(snapshot.val())\n      })\n\n      // Fetch match email\n      const matchDoc = await getDoc(doc(db, 'users', matchId))\n      if (matchDoc.exists()) {\n        matchEmail.value = matchDoc.data().email\n      }\n    })\n\n    onUnmounted(() => {\n      off(chatRef)\n    })\n\n    const sendMessage = () => {\n      if (newMessage.value.trim()) {\n        push(chatRef, {\n          text: newMessage.value,\n          sender: currentUser.uid,\n          timestamp: Date.now()\n        })\n        newMessage.value = ''\n      }\n    }\n\n    return {\n      messages,\n      newMessage,\n      sendMessage,\n      matchEmail,\n      currentUser\n    }\n  }\n}\n</script>\n"],"mappings":";;EACOA,KAAK,EAAC;AAAM;;EAEVA,KAAK,EAAC;AAAU;;uBAFvBC,mBAAA,CAWM,OAXNC,UAWM,GAVJC,mBAAA,CAAmC,YAA/B,YAAU,GAAAC,gBAAA,CAAGC,MAAA,CAAAC,UAAU,kBAC3BH,mBAAA,CAIM,OAJNI,UAIM,I,kBAHJN,mBAAA,CAEMO,SAAA,QANZC,WAAA,CAI6BJ,MAAA,CAAAK,QAAQ,EAAnBC,OAAO;yBAAnBV,mBAAA,CAEM;MAF4BW,GAAG,EAAED,OAAO,CAACE,EAAE;MAAGb,KAAK,EAJ/Dc,eAAA,aAI6EH,OAAO,CAACI,MAAM,KAAKV,MAAA,CAAAW,WAAW,CAACC,GAAG;wBACpGN,OAAO,CAACO,IAAI;oCAGnBf,mBAAA,CAGO;IAHAgB,QAAM,EAAAC,MAAA,QAAAA,MAAA,MARjBC,cAAA,KAAAC,IAAA,KAQ2BjB,MAAA,CAAAkB,WAAA,IAAAlB,MAAA,CAAAkB,WAAA,IAAAD,IAAA,CAAW;sBAChCnB,mBAAA,CAA4D;IATlE,uBAAAiB,MAAA,QAAAA,MAAA,MAAAI,MAAA,IASsBnB,MAAA,CAAAoB,UAAU,GAAAD,MAAA;IAAEE,WAAW,EAAC;iDAAxBrB,MAAA,CAAAoB,UAAU,E,6BAC1BtB,mBAAA,CAAmC;IAA3BwB,IAAI,EAAC;EAAQ,GAAC,MAAI,qB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}